{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mplp.dev/schemas/v1.0/mplp-network.json",
  "title": "MPLP Network Protocol v1.0",
  "description": "Network模块协议Schema - Agent网络拓扑和连接管理",
  "type": "object",
  "$defs": {
    "uuid": {
      "type": "string",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$",
      "description": "UUID v4格式的唯一标识符"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601格式的时间戳"
    },
    "version": {
      "type": "string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
      "description": "语义化版本号 (SemVer)"
    },
    "entityStatus": {
      "type": "string",
      "enum": [
        "active",
        "inactive",
        "pending",
        "completed",
        "failed",
        "cancelled"
      ],
      "description": "实体状态枚举"
    }
  },
  "properties": {
    "network_id": {
      "$ref": "#/$defs/uuid",
      "description": "网络唯一标识符"
    },
    "protocol_version": {
      "type": "string",
      "const": "1.0.0",
      "description": "MPLP协议版本"
    },
    "timestamp": {
      "$ref": "#/$defs/timestamp",
      "description": "网络创建时间戳"
    },
    "context_id": {
      "$ref": "#/$defs/uuid",
      "description": "关联的上下文ID"
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 255,
      "description": "网络名称"
    },
    "description": {
      "type": "string",
      "maxLength": 1024,
      "description": "网络描述"
    },
    "topology": {
      "type": "string",
      "enum": [
        "star",
        "mesh",
        "tree",
        "ring",
        "bus",
        "hybrid",
        "hierarchical"
      ],
      "description": "网络拓扑类型"
    },
    "nodes": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "node_id": {
            "$ref": "#/$defs/uuid",
            "description": "节点唯一标识符"
          },
          "agent_id": {
            "$ref": "#/$defs/uuid",
            "description": "Agent唯一标识符"
          },
          "node_type": {
            "type": "string",
            "enum": [
              "coordinator",
              "worker",
              "gateway",
              "relay",
              "monitor",
              "backup"
            ],
            "description": "节点类型"
          },
          "status": {
            "type": "string",
            "enum": [
              "online",
              "offline",
              "connecting",
              "disconnecting",
              "error",
              "maintenance"
            ],
            "description": "节点状态"
          },
          "capabilities": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "compute",
                "storage",
                "network",
                "coordination",
                "monitoring",
                "security"
              ]
            },
            "maxItems": 10,
            "description": "节点能力列表"
          },
          "address": {
            "type": "object",
            "properties": {
              "host": {
                "type": "string",
                "description": "主机地址"
              },
              "port": {
                "type": "number",
                "minimum": 1,
                "maximum": 65535,
                "description": "端口号"
              },
              "protocol": {
                "type": "string",
                "enum": [
                  "http",
                  "https",
                  "ws",
                  "wss",
                  "tcp",
                  "udp"
                ],
                "description": "通信协议"
              }
            },
            "required": [
              "host",
              "port",
              "protocol"
            ],
            "additionalProperties": false,
            "description": "节点地址信息"
          },
          "metadata": {
            "type": "object",
            "additionalProperties": true,
            "description": "节点元数据"
          }
        },
        "required": [
          "node_id",
          "agent_id",
          "node_type",
          "status"
        ],
        "additionalProperties": false
      },
      "minItems": 1,
      "maxItems": 1000,
      "description": "网络节点列表"
    },
    "edges": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "edge_id": {
            "$ref": "#/$defs/uuid",
            "description": "连接唯一标识符"
          },
          "source_node_id": {
            "$ref": "#/$defs/uuid",
            "description": "源节点ID"
          },
          "target_node_id": {
            "$ref": "#/$defs/uuid",
            "description": "目标节点ID"
          },
          "edge_type": {
            "type": "string",
            "enum": [
              "data",
              "control",
              "monitoring",
              "backup"
            ],
            "description": "连接类型"
          },
          "direction": {
            "type": "string",
            "enum": [
              "unidirectional",
              "bidirectional"
            ],
            "description": "连接方向"
          },
          "status": {
            "$ref": "#/$defs/entityStatus",
            "description": "连接状态"
          },
          "weight": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "连接权重"
          },
          "metadata": {
            "type": "object",
            "additionalProperties": true,
            "description": "连接元数据"
          }
        },
        "required": [
          "edge_id",
          "source_node_id",
          "target_node_id",
          "edge_type",
          "direction",
          "status"
        ],
        "additionalProperties": false
      },
      "maxItems": 10000,
      "description": "网络连接列表"
    },
    "discovery_mechanism": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "static",
            "dynamic",
            "hybrid",
            "dns",
            "registry",
            "broadcast"
          ],
          "description": "发现机制类型"
        },
        "registry_config": {
          "type": "object",
          "properties": {
            "endpoint": {
              "type": "string",
              "format": "uri",
              "description": "注册中心端点"
            },
            "authentication": {
              "type": "boolean",
              "default": false,
              "description": "是否需要身份验证"
            },
            "refresh_interval": {
              "type": "number",
              "minimum": 1,
              "description": "刷新间隔(秒)"
            }
          },
          "additionalProperties": false,
          "description": "注册中心配置"
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false,
      "description": "节点发现机制"
    },
    "routing_strategy": {
      "type": "object",
      "properties": {
        "algorithm": {
          "type": "string",
          "enum": [
            "shortest_path",
            "load_balanced",
            "priority_based",
            "custom"
          ],
          "description": "路由算法"
        },
        "load_balancing": {
          "type": "object",
          "properties": {
            "method": {
              "type": "string",
              "enum": [
                "round_robin",
                "weighted",
                "least_connections",
                "random"
              ],
              "description": "负载均衡方法"
            }
          },
          "additionalProperties": false,
          "description": "负载均衡配置"
        }
      },
      "required": [
        "algorithm"
      ],
      "additionalProperties": false,
      "description": "路由策略"
    },
    "status": {
      "$ref": "#/$defs/entityStatus",
      "description": "网络状态"
    },
    "created_at": {
      "$ref": "#/$defs/timestamp",
      "description": "网络创建时间"
    },
    "updated_at": {
      "$ref": "#/$defs/timestamp",
      "description": "网络最后更新时间"
    },
    "created_by": {
      "$ref": "#/$defs/uuid",
      "description": "网络创建者ID"
    },
    "metadata": {
      "type": "object",
      "additionalProperties": true,
      "description": "网络元数据"
    },
    "audit_trail": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "retention_days": { "type": "integer", "minimum": 1, "maximum": 2555 },
        "audit_events": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "event_id": { "$ref": "#/$defs/uuid" },
              "event_type": {
                "type": "string",
                "enum": ["network_created", "network_updated", "node_joined", "node_left", "connection_established", "connection_lost", "routing_changed", "security_violation", "topology_updated"]
              },
              "timestamp": { "$ref": "#/$defs/timestamp" },
              "user_id": { "type": "string" },
              "user_role": { "type": "string" },
              "action": { "type": "string" },
              "resource": { "type": "string" },
              "network_operation": { "type": "string" },
              "network_id": { "$ref": "#/$defs/uuid" },
              "network_name": { "type": "string" },
              "network_type": { "type": "string" },
              "node_ids": {
                "type": "array",
                "items": { "type": "string" }
              },
              "network_status": { "type": "string" },
              "node_id": { "$ref": "#/$defs/uuid" },
              "connection_details": { "type": "object" },
              "network_details": { "type": "object" },
              "ip_address": { "type": "string" },
              "user_agent": { "type": "string" },
              "session_id": { "type": "string" },
              "correlation_id": { "$ref": "#/$defs/uuid" }
            },
            "required": ["event_id", "event_type", "timestamp", "user_id", "action", "resource"]
          }
        },
        "compliance_settings": {
          "type": "object",
          "properties": {
            "gdpr_enabled": { "type": "boolean" },
            "hipaa_enabled": { "type": "boolean" },
            "sox_enabled": { "type": "boolean" },
            "network_audit_level": {
              "type": "string",
              "enum": ["basic", "detailed", "comprehensive"]
            },
            "network_data_logging": { "type": "boolean" },
            "traffic_logging": { "type": "boolean" },
            "custom_compliance": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        }
      },
      "required": ["enabled", "retention_days"]
    },
    "monitoring_integration": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "supported_providers": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["prometheus", "grafana", "datadog", "new_relic", "elastic_apm", "custom"]
          }
        },
        "integration_endpoints": {
          "type": "object",
          "properties": {
            "metrics_api": { "type": "string", "format": "uri" },
            "network_performance_api": { "type": "string", "format": "uri" },
            "traffic_analysis_api": { "type": "string", "format": "uri" },
            "connection_status_api": { "type": "string", "format": "uri" }
          }
        },
        "network_metrics": {
          "type": "object",
          "properties": {
            "track_network_performance": { "type": "boolean" },
            "track_traffic_flow": { "type": "boolean" },
            "track_connection_status": { "type": "boolean" },
            "track_security_events": { "type": "boolean" }
          }
        },
        "export_formats": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["prometheus", "opentelemetry", "custom"]
          }
        }
      },
      "required": ["enabled", "supported_providers"]
    },
    "performance_metrics": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "collection_interval_seconds": { "type": "integer", "minimum": 10, "maximum": 3600 },
        "metrics": {
          "type": "object",
          "properties": {
            "network_communication_latency_ms": { "type": "number", "minimum": 0 },
            "network_topology_efficiency_score": { "type": "number", "minimum": 0, "maximum": 10 },
            "network_reliability_score": { "type": "number", "minimum": 0, "maximum": 10 },
            "connection_success_rate_percent": { "type": "number", "minimum": 0, "maximum": 100 },
            "network_management_efficiency_score": { "type": "number", "minimum": 0, "maximum": 10 },
            "active_connections_count": { "type": "integer", "minimum": 0 },
            "network_operations_per_second": { "type": "number", "minimum": 0 },
            "network_memory_usage_mb": { "type": "number", "minimum": 0 },
            "average_network_complexity_score": { "type": "number", "minimum": 0, "maximum": 10 }
          }
        },
        "health_status": {
          "type": "object",
          "properties": {
            "status": {
              "type": "string",
              "enum": ["healthy", "degraded", "unhealthy", "partitioned"]
            },
            "last_check": { "$ref": "#/$defs/timestamp" },
            "checks": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "check_name": { "type": "string" },
                  "status": {
                    "type": "string",
                    "enum": ["pass", "fail", "warn"]
                  },
                  "message": { "type": "string" },
                  "duration_ms": { "type": "number", "minimum": 0 }
                },
                "required": ["check_name", "status"]
              }
            }
          }
        },
        "alerting": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "thresholds": {
              "type": "object",
              "properties": {
                "max_network_communication_latency_ms": { "type": "number", "minimum": 0 },
                "min_network_topology_efficiency_score": { "type": "number", "minimum": 0, "maximum": 10 },
                "min_network_reliability_score": { "type": "number", "minimum": 0, "maximum": 10 },
                "min_connection_success_rate_percent": { "type": "number", "minimum": 0, "maximum": 100 },
                "min_network_management_efficiency_score": { "type": "number", "minimum": 0, "maximum": 10 }
              }
            },
            "notification_channels": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["email", "slack", "webhook", "sms", "pagerduty"]
              }
            }
          }
        }
      },
      "required": ["enabled", "collection_interval_seconds"]
    },
    "version_history": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "max_versions": { "type": "integer", "minimum": 1, "maximum": 100, "default": 50 },
        "versions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "version_id": { "$ref": "#/$defs/uuid" },
              "version_number": { "type": "integer", "minimum": 1 },
              "created_at": { "$ref": "#/$defs/timestamp" },
              "created_by": { "type": "string" },
              "change_summary": { "type": "string" },
              "network_snapshot": { "type": "object" },
              "change_type": {
                "type": "string",
                "enum": ["network_created", "topology_updated", "nodes_added", "nodes_removed", "routing_changed", "configuration_updated"]
              }
            },
            "required": ["version_id", "version_number", "created_at", "created_by", "change_type"]
          }
        },
        "auto_versioning": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "version_on_topology_change": { "type": "boolean" },
            "version_on_node_change": { "type": "boolean" },
            "version_on_routing_change": { "type": "boolean" }
          }
        }
      },
      "required": ["enabled", "max_versions"]
    },
    "search_metadata": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "indexing_strategy": {
          "type": "string",
          "enum": ["full_text", "keyword", "semantic", "hybrid"]
        },
        "searchable_fields": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["network_id", "name", "topology", "nodes", "routing_strategy", "performance_metrics", "metadata", "audit_logs"]
          }
        },
        "search_indexes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "index_id": { "type": "string" },
              "index_name": { "type": "string" },
              "fields": { "type": "array", "items": { "type": "string" } },
              "index_type": {
                "type": "string",
                "enum": ["btree", "hash", "gin", "gist", "full_text"]
              },
              "created_at": { "$ref": "#/$defs/timestamp" },
              "last_updated": { "$ref": "#/$defs/timestamp" }
            },
            "required": ["index_id", "index_name", "fields", "index_type"]
          }
        },
        "network_indexing": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "index_topology_data": { "type": "boolean" },
            "index_performance_metrics": { "type": "boolean" },
            "index_audit_logs": { "type": "boolean" }
          }
        },
        "auto_indexing": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "index_new_networks": { "type": "boolean" },
            "reindex_interval_hours": { "type": "integer", "minimum": 1 }
          }
        }
      },
      "required": ["enabled", "indexing_strategy"]
    },

    "network_operation": {

      "type": "string",

      "enum": [

        "connect",

        "disconnect",

        "route",

        "broadcast",

        "discover"

      ],

      "description": "网络操作类型"

    },

    "network_details": {

      "type": "object",

      "properties": {

        "network_topology": {

          "type": "string",

          "enum": [

            "star",

            "mesh",

            "ring",

            "tree"

          ]

        },

        "protocol_type": {

          "type": "string",

          "enum": [

            "tcp",

            "udp",

            "websocket",

            "http"

          ]

        },

        "security_mode": {

          "type": "string",

          "enum": [

            "none",

            "tls",

            "mtls",

            "custom"

          ]

        }

      },

      "description": "网络详细配置"

    },
    "event_integration": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "event_bus_connection": {
          "type": "object",
          "properties": {
            "bus_type": {
              "type": "string",
              "enum": ["kafka", "rabbitmq", "redis", "nats", "custom"]
            },
            "connection_string": { "type": "string" },
            "topic_prefix": { "type": "string" },
            "consumer_group": { "type": "string" }
          }
        },
        "published_events": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["network_created", "network_updated", "node_joined", "node_left", "connection_established", "connection_lost", "routing_changed", "performance_degraded"]
          }
        },
        "subscribed_events": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["context_updated", "plan_executed", "confirm_approved", "trace_completed", "role_assigned", "extension_activated", "dialog_started", "core_coordinated"]
          }
        },
        "event_routing": {
          "type": "object",
          "properties": {
            "routing_rules": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "rule_id": { "type": "string" },
                  "condition": { "type": "string" },
                  "target_topic": { "type": "string" },
                  "enabled": { "type": "boolean" }
                },
                "required": ["rule_id", "condition", "target_topic"]
              }
            }
          }
        }
      },
      "required": ["enabled"]
    }
  },
  "required": [
    "network_id",
    "protocol_version",
    "timestamp",
    "context_id",
    "name",
    "topology",
    "nodes",
    "discovery_mechanism",
    "routing_strategy",
    "status",
    "created_at",
    "created_by",
    "audit_trail",
    "monitoring_integration",
    "performance_metrics",
    "version_history",
    "search_metadata", "network_operation",
    "event_integration"
  ],
  "additionalProperties": false
}