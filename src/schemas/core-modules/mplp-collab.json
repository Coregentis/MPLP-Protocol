{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mplp.dev/schemas/v1.0/mplp-collab.json",
  "title": "MPLP Collab Protocol v1.0",
  "description": "Collab模块协议Schema - 多Agent协作调度和协调",
  "type": "object",
  "$defs": {
    "uuid": {
      "type": "string",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$",
      "description": "UUID v4格式的唯一标识符"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601格式的时间戳"
    },
    "version": {
      "type": "string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
      "description": "语义化版本号 (SemVer)"
    },
    "entityStatus": {
      "type": "string",
      "enum": [
        "active",
        "inactive",
        "pending",
        "completed",
        "failed",
        "cancelled"
      ],
      "description": "实体状态枚举"
    },
    "decision_algorithm": {
      "type": "string",
      "enum": [
        "majority_vote",
        "consensus",
        "weighted_vote",
        "pbft",
        "custom"
      ],
      "description": "决策算法类型"
    },
    "voting_mechanism": {
      "type": "object",
      "description": "投票机制配置",
      "properties": {
        "anonymity": {
          "type": "boolean",
          "description": "是否匿名投票"
        },
        "transparency": {
          "type": "boolean",
          "description": "是否透明投票"
        },
        "revision_allowed": {
          "type": "boolean",
          "description": "是否允许修改投票"
        },
        "time_limit_ms": {
          "type": "integer",
          "minimum": 1000,
          "description": "投票时间限制(毫秒)"
        }
      },
      "required": [
        "anonymity",
        "transparency",
        "revision_allowed"
      ],
      "additionalProperties": false
    },
    "weighting_strategy": {
      "type": "object",
      "description": "权重策略配置",
      "properties": {
        "strategy": {
          "type": "string",
          "enum": [
            "equal",
            "expertise_based",
            "role_based",
            "performance_based"
          ],
          "description": "权重策略类型"
        },
        "weights": {
          "type": "object",
          "additionalProperties": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "description": "参与者权重映射"
        }
      },
      "required": [
        "strategy"
      ],
      "additionalProperties": false
    },
    "consensus_requirements": {
      "type": "object",
      "description": "共识要求配置",
      "properties": {
        "threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "共识阈值(0-1)"
        },
        "quorum": {
          "type": "integer",
          "minimum": 1,
          "description": "最小参与者数量"
        },
        "unanimity_required": {
          "type": "boolean",
          "description": "是否需要一致同意"
        }
      },
      "required": [
        "threshold",
        "quorum"
      ],
      "additionalProperties": false
    }
  },
  "properties": {
    "collaboration_id": {
      "$ref": "#/$defs/uuid",
      "description": "协作唯一标识符"
    },
    "protocol_version": {
      "type": "string",
      "const": "1.0.0",
      "description": "MPLP协议版本"
    },
    "timestamp": {
      "$ref": "#/$defs/timestamp",
      "description": "协作创建时间戳"
    },
    "context_id": {
      "$ref": "#/$defs/uuid",
      "description": "关联的上下文ID"
    },
    "plan_id": {
      "$ref": "#/$defs/uuid",
      "description": "关联的计划ID"
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 255,
      "description": "协作名称"
    },
    "description": {
      "type": "string",
      "maxLength": 1024,
      "description": "协作描述"
    },
    "mode": {
      "type": "string",
      "enum": [
        "sequential",
        "parallel",
        "hybrid",
        "pipeline",
        "mesh"
      ],
      "description": "协作执行模式"
    },
    "participants": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "participant_id": {
            "$ref": "#/$defs/uuid",
            "description": "参与者唯一标识符"
          },
          "agent_id": {
            "$ref": "#/$defs/uuid",
            "description": "Agent唯一标识符"
          },
          "role_id": {
            "$ref": "#/$defs/uuid",
            "description": "角色唯一标识符"
          },
          "status": {
            "$ref": "#/$defs/entityStatus",
            "description": "参与者状态"
          },
          "capabilities": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "maxItems": 20,
            "description": "参与者能力列表"
          },
          "priority": {
            "type": "number",
            "minimum": 0,
            "maximum": 100,
            "description": "参与者优先级"
          },
          "weight": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "参与者权重"
          },
          "joined_at": {
            "$ref": "#/$defs/timestamp",
            "description": "参与者加入时间"
          }
        },
        "required": [
          "participant_id",
          "agent_id",
          "role_id",
          "status"
        ],
        "additionalProperties": false
      },
      "minItems": 2,
      "maxItems": 100,
      "description": "协作参与者列表"
    },
    "coordination_strategy": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "centralized",
            "distributed",
            "hierarchical",
            "peer_to_peer"
          ],
          "description": "协调策略类型"
        },
        "coordinator_id": {
          "$ref": "#/$defs/uuid",
          "description": "协调者ID"
        },
        "decision_making": {
          "type": "string",
          "enum": [
            "consensus",
            "majority",
            "weighted",
            "coordinator"
          ],
          "description": "决策机制"
        }
      },
      "required": [
        "type",
        "decision_making"
      ],
      "additionalProperties": false,
      "description": "协调策略配置"
    },
    "status": {
      "$ref": "#/$defs/entityStatus",
      "description": "协作状态"
    },
    "created_at": {
      "$ref": "#/$defs/timestamp",
      "description": "协作创建时间"
    },
    "updated_at": {
      "$ref": "#/$defs/timestamp",
      "description": "协作最后更新时间"
    },
    "created_by": {
      "$ref": "#/$defs/uuid",
      "description": "协作创建者ID"
    },
    "decision_making": {
      "type": "object",
      "description": "决策制定配置",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "是否启用决策功能"
        },
        "algorithm": {
          "$ref": "#/$defs/decision_algorithm"
        },
        "voting": {
          "$ref": "#/$defs/voting_mechanism"
        },
        "weighting": {
          "$ref": "#/$defs/weighting_strategy"
        },
        "consensus": {
          "$ref": "#/$defs/consensus_requirements"
        }
      },
      "required": [
        "enabled"
      ],
      "additionalProperties": false
    },
    "council_configuration": {
      "type": "object",
      "description": "决策议会配置",
      "properties": {
        "council_type": {
          "type": "string",
          "enum": [
            "advisory",
            "executive",
            "judicial",
            "mixed"
          ],
          "description": "议会类型"
        },
        "session_management": {
          "type": "object",
          "properties": {
            "max_session_duration_ms": {
              "type": "integer",
              "minimum": 60000
            },
            "quorum_enforcement": {
              "type": "boolean"
            },
            "automatic_adjournment": {
              "type": "boolean"
            }
          },
          "required": [
            "max_session_duration_ms",
            "quorum_enforcement"
          ]
        },
        "voting_rules": {
          "type": "object",
          "properties": {
            "multiple_rounds_allowed": {
              "type": "boolean"
            },
            "abstention_allowed": {
              "type": "boolean"
            },
            "delegation_allowed": {
              "type": "boolean"
            }
          },
          "required": [
            "multiple_rounds_allowed",
            "abstention_allowed"
          ]
        }
      },
      "additionalProperties": false
    },
    "metadata": {
      "type": "object",
      "additionalProperties": true,
      "description": "协作元数据"
    },
    "audit_trail": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "retention_days": { "type": "integer", "minimum": 1, "maximum": 2555 },
        "audit_events": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "event_id": { "$ref": "#/$defs/uuid" },
              "event_type": {
                "type": "string",
                "enum": ["collaboration_started", "collaboration_ended", "participant_joined", "participant_left", "task_assigned", "task_completed", "decision_made", "conflict_resolved", "collaboration_updated"]
              },
              "timestamp": { "$ref": "#/$defs/timestamp" },
              "user_id": { "type": "string" },
              "user_role": { "type": "string" },
              "action": { "type": "string" },
              "resource": { "type": "string" },
              "collaboration_operation": { "type": "string" },
              "collab_id": { "$ref": "#/$defs/uuid" },
              "collab_name": { "type": "string" },
              "collab_type": { "type": "string" },
              "participant_ids": {
                "type": "array",
                "items": { "type": "string" }
              },
              "collab_status": { "type": "string" },
              "participant_id": { "$ref": "#/$defs/uuid" },
              "task_details": { "type": "object" },
              "decision_details": { "type": "object" },
              "collab_details": { "type": "object" },
              "ip_address": { "type": "string" },
              "user_agent": { "type": "string" },
              "session_id": { "type": "string" },
              "correlation_id": { "$ref": "#/$defs/uuid" }
            },
            "required": ["event_id", "event_type", "timestamp", "user_id", "action", "resource"]
          }
        },
        "compliance_settings": {
          "type": "object",
          "properties": {
            "gdpr_enabled": { "type": "boolean" },
            "hipaa_enabled": { "type": "boolean" },
            "sox_enabled": { "type": "boolean" },
            "collab_audit_level": {
              "type": "string",
              "enum": ["basic", "detailed", "comprehensive"]
            },
            "collab_data_logging": { "type": "boolean" },
            "decision_logging": { "type": "boolean" },
            "custom_compliance": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        }
      },
      "required": ["enabled", "retention_days"]
    },
    "monitoring_integration": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "supported_providers": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["prometheus", "grafana", "datadog", "new_relic", "elastic_apm", "custom"]
          }
        },
        "integration_endpoints": {
          "type": "object",
          "properties": {
            "metrics_api": { "type": "string", "format": "uri" },
            "collaboration_efficiency_api": { "type": "string", "format": "uri" },
            "team_performance_api": { "type": "string", "format": "uri" },
            "task_coordination_api": { "type": "string", "format": "uri" }
          }
        },
        "collaboration_metrics": {
          "type": "object",
          "properties": {
            "track_collaboration_efficiency": { "type": "boolean" },
            "track_team_performance": { "type": "boolean" },
            "track_task_coordination": { "type": "boolean" },
            "track_decision_quality": { "type": "boolean" }
          }
        },
        "export_formats": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["prometheus", "opentelemetry", "custom"]
          }
        }
      },
      "required": ["enabled", "supported_providers"]
    },
    "performance_metrics": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "collection_interval_seconds": { "type": "integer", "minimum": 10, "maximum": 3600 },
        "metrics": {
          "type": "object",
          "properties": {
            "collab_coordination_latency_ms": { "type": "number", "minimum": 0 },
            "team_collaboration_efficiency_score": { "type": "number", "minimum": 0, "maximum": 10 },
            "collaboration_quality_score": { "type": "number", "minimum": 0, "maximum": 10 },
            "participant_engagement_satisfaction_percent": { "type": "number", "minimum": 0, "maximum": 100 },
            "collab_management_efficiency_score": { "type": "number", "minimum": 0, "maximum": 10 },
            "active_collaborations_count": { "type": "integer", "minimum": 0 },
            "collab_operations_per_second": { "type": "number", "minimum": 0 },
            "collab_memory_usage_mb": { "type": "number", "minimum": 0 },
            "average_collaboration_complexity_score": { "type": "number", "minimum": 0, "maximum": 10 }
          }
        },
        "health_status": {
          "type": "object",
          "properties": {
            "status": {
              "type": "string",
              "enum": ["healthy", "degraded", "unhealthy", "conflicted"]
            },
            "last_check": { "$ref": "#/$defs/timestamp" },
            "checks": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "check_name": { "type": "string" },
                  "status": {
                    "type": "string",
                    "enum": ["pass", "fail", "warn"]
                  },
                  "message": { "type": "string" },
                  "duration_ms": { "type": "number", "minimum": 0 }
                },
                "required": ["check_name", "status"]
              }
            }
          }
        },
        "alerting": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "thresholds": {
              "type": "object",
              "properties": {
                "max_collab_coordination_latency_ms": { "type": "number", "minimum": 0 },
                "min_team_collaboration_efficiency_score": { "type": "number", "minimum": 0, "maximum": 10 },
                "min_collaboration_quality_score": { "type": "number", "minimum": 0, "maximum": 10 },
                "min_participant_engagement_satisfaction_percent": { "type": "number", "minimum": 0, "maximum": 100 },
                "min_collab_management_efficiency_score": { "type": "number", "minimum": 0, "maximum": 10 }
              }
            },
            "notification_channels": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["email", "slack", "webhook", "sms", "pagerduty"]
              }
            }
          }
        }
      },
      "required": ["enabled", "collection_interval_seconds"]
    },
    "version_history": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "max_versions": { "type": "integer", "minimum": 1, "maximum": 100, "default": 50 },
        "versions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "version_id": { "$ref": "#/$defs/uuid" },
              "version_number": { "type": "integer", "minimum": 1 },
              "created_at": { "$ref": "#/$defs/timestamp" },
              "created_by": { "type": "string" },
              "change_summary": { "type": "string" },
              "collaboration_snapshot": { "type": "object" },
              "change_type": {
                "type": "string",
                "enum": ["collaboration_created", "participants_updated", "strategy_changed", "configuration_updated", "permissions_modified"]
              }
            },
            "required": ["version_id", "version_number", "created_at", "created_by", "change_type"]
          }
        },
        "auto_versioning": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "version_on_participant_change": { "type": "boolean" },
            "version_on_strategy_change": { "type": "boolean" },
            "version_on_permission_change": { "type": "boolean" }
          }
        }
      },
      "required": ["enabled", "max_versions"]
    },
    "search_metadata": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "indexing_strategy": {
          "type": "string",
          "enum": ["full_text", "keyword", "semantic", "hybrid"]
        },
        "searchable_fields": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["collaboration_id", "name", "participants", "tasks", "decisions", "coordination_strategy", "metadata", "audit_logs"]
          }
        },
        "search_indexes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "index_id": { "type": "string" },
              "index_name": { "type": "string" },
              "fields": { "type": "array", "items": { "type": "string" } },
              "index_type": {
                "type": "string",
                "enum": ["btree", "hash", "gin", "gist", "full_text"]
              },
              "created_at": { "$ref": "#/$defs/timestamp" },
              "last_updated": { "$ref": "#/$defs/timestamp" }
            },
            "required": ["index_id", "index_name", "fields", "index_type"]
          }
        },
        "collaboration_indexing": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "index_task_data": { "type": "boolean" },
            "index_decision_data": { "type": "boolean" },
            "index_performance_metrics": { "type": "boolean" }
          }
        },
        "auto_indexing": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "index_new_collaborations": { "type": "boolean" },
            "reindex_interval_hours": { "type": "integer", "minimum": 1 }
          }
        }
      },
      "required": ["enabled", "indexing_strategy"]
    },
    "collab_operation": {
      "type": "string",
      "enum": ["initiate", "join", "coordinate", "synchronize", "finalize"],
      "description": "协作操作类型"
    },

    "collab_details": {
      "type": "object",
      "properties": {
        "collaboration_type": {
          "type": "string",
          "enum": [
            "real_time",
            "asynchronous",
            "hybrid"
          ]
        },
        "participant_limit": {
          "type": "integer",
          "minimum": 2,
          "maximum": 100
        },
        "coordination_strategy": {
          "type": "string",
          "enum": [
            "centralized",
            "distributed",
            "peer_to_peer"
          ]
        }
      },
      "description": "协作详细配置"
    },
    "task_assignment_data": {
      "type": "object",
      "properties": {
        "task_id": {
          "$ref": "#/$defs/uuid",
          "description": "任务唯一标识符"
        },
        "collaboration_id": {
          "$ref": "#/$defs/uuid",
          "description": "关联的协作ID"
        },
        "assignee_id": {
          "$ref": "#/$defs/uuid",
          "description": "任务分配对象ID"
        },
        "task_name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 255,
          "description": "任务名称"
        },
        "task_description": {
          "type": "string",
          "maxLength": 1024,
          "description": "任务描述"
        },
        "task_type": {
          "type": "string",
          "enum": ["analysis", "execution", "coordination", "review", "decision"],
          "description": "任务类型"
        },
        "priority": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"],
          "description": "任务优先级"
        },
        "status": {
          "type": "string",
          "enum": ["pending", "assigned", "in_progress", "completed", "failed", "cancelled"],
          "description": "任务状态"
        },
        "assigned_at": {
          "$ref": "#/$defs/timestamp",
          "description": "任务分配时间"
        },
        "due_date": {
          "$ref": "#/$defs/timestamp",
          "description": "任务截止时间"
        },
        "estimated_duration_ms": {
          "type": "integer",
          "minimum": 1000,
          "description": "预估执行时间(毫秒)"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/uuid"
          },
          "description": "任务依赖列表"
        }
      },
      "required": ["task_id", "collaboration_id", "assignee_id", "task_name", "task_type", "priority", "status"],
      "additionalProperties": false,
      "description": "任务分配数据结构"
    },
    "resource_allocation_data": {
      "type": "object",
      "properties": {
        "allocation_id": {
          "$ref": "#/$defs/uuid",
          "description": "资源分配唯一标识符"
        },
        "collaboration_id": {
          "$ref": "#/$defs/uuid",
          "description": "关联的协作ID"
        },
        "resource_type": {
          "type": "string",
          "enum": ["compute", "storage", "network", "memory", "custom"],
          "description": "资源类型"
        },
        "resource_name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 255,
          "description": "资源名称"
        },
        "allocated_to": {
          "$ref": "#/$defs/uuid",
          "description": "资源分配对象ID"
        },
        "allocation_amount": {
          "type": "number",
          "minimum": 0,
          "description": "分配数量"
        },
        "allocation_unit": {
          "type": "string",
          "enum": ["cpu_cores", "memory_gb", "storage_gb", "bandwidth_mbps", "instances", "custom"],
          "description": "分配单位"
        },
        "allocation_status": {
          "type": "string",
          "enum": ["pending", "allocated", "active", "released", "failed"],
          "description": "分配状态"
        },
        "allocated_at": {
          "$ref": "#/$defs/timestamp",
          "description": "资源分配时间"
        },
        "expires_at": {
          "$ref": "#/$defs/timestamp",
          "description": "资源过期时间"
        },
        "priority": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"],
          "description": "资源优先级"
        }
      },
      "required": ["allocation_id", "collaboration_id", "resource_type", "resource_name", "allocated_to", "allocation_amount", "allocation_unit", "allocation_status"],
      "additionalProperties": false,
      "description": "资源分配数据结构"
    },
    "collaboration_effectiveness_analysis": {
      "type": "object",
      "properties": {
        "analysis_id": {
          "$ref": "#/$defs/uuid",
          "description": "分析唯一标识符"
        },
        "collaboration_id": {
          "$ref": "#/$defs/uuid",
          "description": "关联的协作ID"
        },
        "effectiveness_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 10,
          "description": "协作效果评分(0-10)"
        },
        "efficiency_metrics": {
          "type": "object",
          "properties": {
            "task_completion_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "任务完成率(0-1)"
            },
            "average_response_time_ms": {
              "type": "number",
              "minimum": 0,
              "description": "平均响应时间(毫秒)"
            },
            "resource_utilization_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "资源利用率(0-1)"
            },
            "participant_engagement_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 10,
              "description": "参与者参与度评分"
            }
          },
          "required": ["task_completion_rate", "average_response_time_ms", "resource_utilization_rate", "participant_engagement_score"]
        },
        "quality_metrics": {
          "type": "object",
          "properties": {
            "decision_quality_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 10,
              "description": "决策质量评分"
            },
            "communication_effectiveness": {
              "type": "number",
              "minimum": 0,
              "maximum": 10,
              "description": "沟通效果评分"
            },
            "conflict_resolution_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "冲突解决率"
            }
          },
          "required": ["decision_quality_score", "communication_effectiveness", "conflict_resolution_rate"]
        },
        "analyzed_at": {
          "$ref": "#/$defs/timestamp",
          "description": "分析时间"
        },
        "recommendations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "recommendation_id": {
                "$ref": "#/$defs/uuid"
              },
              "category": {
                "type": "string",
                "enum": ["efficiency", "quality", "communication", "resource_allocation"]
              },
              "priority": {
                "type": "string",
                "enum": ["low", "medium", "high", "critical"]
              },
              "description": {
                "type": "string",
                "maxLength": 512
              },
              "expected_impact": {
                "type": "number",
                "minimum": 0,
                "maximum": 10
              }
            },
            "required": ["recommendation_id", "category", "priority", "description"]
          },
          "description": "改进建议列表"
        }
      },
      "required": ["analysis_id", "collaboration_id", "effectiveness_score", "efficiency_metrics", "quality_metrics", "analyzed_at"],
      "additionalProperties": false,
      "description": "协作效果分析结果"
    },
    "collaboration_pattern_analysis": {
      "type": "object",
      "properties": {
        "analysis_id": {
          "$ref": "#/$defs/uuid",
          "description": "分析唯一标识符"
        },
        "time_range": {
          "type": "object",
          "properties": {
            "start_time": {
              "$ref": "#/$defs/timestamp"
            },
            "end_time": {
              "$ref": "#/$defs/timestamp"
            }
          },
          "required": ["start_time", "end_time"]
        },
        "identified_patterns": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "pattern_id": {
                "$ref": "#/$defs/uuid"
              },
              "pattern_type": {
                "type": "string",
                "enum": ["communication", "decision_making", "task_allocation", "resource_usage", "temporal"]
              },
              "pattern_name": {
                "type": "string",
                "maxLength": 255
              },
              "frequency": {
                "type": "integer",
                "minimum": 1,
                "description": "模式出现频次"
              },
              "confidence_score": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "模式置信度"
              },
              "impact_assessment": {
                "type": "object",
                "properties": {
                  "positive_impact": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 10
                  },
                  "negative_impact": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 10
                  },
                  "overall_impact": {
                    "type": "number",
                    "minimum": -10,
                    "maximum": 10
                  }
                },
                "required": ["positive_impact", "negative_impact", "overall_impact"]
              }
            },
            "required": ["pattern_id", "pattern_type", "pattern_name", "frequency", "confidence_score", "impact_assessment"]
          }
        },
        "trend_analysis": {
          "type": "object",
          "properties": {
            "collaboration_frequency_trend": {
              "type": "string",
              "enum": ["increasing", "decreasing", "stable", "volatile"]
            },
            "efficiency_trend": {
              "type": "string",
              "enum": ["improving", "declining", "stable", "volatile"]
            },
            "participant_engagement_trend": {
              "type": "string",
              "enum": ["increasing", "decreasing", "stable", "volatile"]
            }
          },
          "required": ["collaboration_frequency_trend", "efficiency_trend", "participant_engagement_trend"]
        },
        "analyzed_at": {
          "$ref": "#/$defs/timestamp",
          "description": "分析时间"
        }
      },
      "required": ["analysis_id", "time_range", "identified_patterns", "trend_analysis", "analyzed_at"],
      "additionalProperties": false,
      "description": "协作模式分析结果"
    },
    "governance_check_result": {
      "type": "object",
      "properties": {
        "check_id": {
          "$ref": "#/$defs/uuid",
          "description": "检查唯一标识符"
        },
        "collaboration_id": {
          "$ref": "#/$defs/uuid",
          "description": "关联的协作ID"
        },
        "check_type": {
          "type": "string",
          "enum": ["compliance", "policy", "security", "data_protection", "audit"],
          "description": "检查类型"
        },
        "check_status": {
          "type": "string",
          "enum": ["passed", "failed", "warning", "not_applicable"],
          "description": "检查状态"
        },
        "compliance_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "合规评分(0-100)"
        },
        "violations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "violation_id": {
                "$ref": "#/$defs/uuid"
              },
              "violation_type": {
                "type": "string",
                "enum": ["policy_violation", "security_breach", "data_leak", "access_violation", "audit_failure"]
              },
              "severity": {
                "type": "string",
                "enum": ["low", "medium", "high", "critical"]
              },
              "description": {
                "type": "string",
                "maxLength": 512
              },
              "remediation_required": {
                "type": "boolean"
              },
              "remediation_steps": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            },
            "required": ["violation_id", "violation_type", "severity", "description", "remediation_required"]
          }
        },
        "checked_at": {
          "$ref": "#/$defs/timestamp",
          "description": "检查时间"
        },
        "next_check_due": {
          "$ref": "#/$defs/timestamp",
          "description": "下次检查时间"
        }
      },
      "required": ["check_id", "collaboration_id", "check_type", "check_status", "compliance_score", "checked_at"],
      "additionalProperties": false,
      "description": "治理检查结果"
    },
    "event_integration": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "event_bus_connection": {
          "type": "object",
          "properties": {
            "bus_type": {
              "type": "string",
              "enum": ["kafka", "rabbitmq", "redis", "nats", "custom"]
            },
            "connection_string": { "type": "string" },
            "topic_prefix": { "type": "string" },
            "consumer_group": { "type": "string" }
          }
        },
        "published_events": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["collaboration_started", "collaboration_ended", "participant_joined", "participant_left", "task_assigned", "task_completed", "decision_made", "conflict_resolved"]
          }
        },
        "subscribed_events": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["context_updated", "plan_executed", "confirm_approved", "trace_completed", "role_assigned", "extension_activated", "dialog_started", "network_connected"]
          }
        },
        "event_routing": {
          "type": "object",
          "properties": {
            "routing_rules": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "rule_id": { "type": "string" },
                  "condition": { "type": "string" },
                  "target_topic": { "type": "string" },
                  "enabled": { "type": "boolean" }
                },
                "required": ["rule_id", "condition", "target_topic"]
              }
            }
          }
        }
      },
      "required": ["enabled"]
    }
  },
  "required": [
    "collaboration_id",
    "protocol_version",
    "timestamp",
    "context_id",
    "plan_id",
    "name",
    "mode",
    "participants",
    "coordination_strategy",
    "status",
    "created_at",
    "created_by",
    "audit_trail",
    "monitoring_integration",
    "performance_metrics",
    "version_history",
    "search_metadata",
    "collab_operation",
    "event_integration"
  ],
  "additionalProperties": false
}