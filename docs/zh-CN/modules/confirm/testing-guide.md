# ConfirmÊ®°ÂùóÊµãËØïÊåáÂçó

> **üåê ËØ≠Ë®ÄÂØºËà™**: [English](../../../en/modules/confirm/testing-guide.md) | [‰∏≠Êñá](testing-guide.md)



**Â§öÊô∫ËÉΩ‰ΩìÂçèËÆÆÁîüÂëΩÂë®ÊúüÂπ≥Âè∞ - ConfirmÊ®°ÂùóÊµãËØïÊåáÂçó v1.0.0-alpha**

[![ÊµãËØï](https://img.shields.io/badge/testing-Enterprise%20Validated-green.svg)](./README.md)
[![Ë¶ÜÁõñÁéá](https://img.shields.io/badge/coverage-100%25-green.svg)](./implementation-guide.md)
[![Â∑•‰ΩúÊµÅ](https://img.shields.io/badge/workflow-Tested-blue.svg)](./performance-guide.md)
[![ËØ≠Ë®Ä](https://img.shields.io/badge/language-‰∏≠Êñá-blue.svg)](../../en/modules/confirm/testing-guide.md)

---

## üéØ ÊµãËØïÊ¶ÇËßà

Êú¨ÁªºÂêàÊµãËØïÊåáÂçóÊèê‰æõÊµãËØïConfirmÊ®°Âùó‰ºÅ‰∏öÂ∑•‰ΩúÊµÅÂºïÊìé„ÄÅÂÆ°ÊâπÁ≥ªÁªü„ÄÅÂÜ≥Á≠ñÊîØÊåÅÂäüËÉΩÂíåÂêàËßÑÊú∫Âà∂ÁöÑÁ≠ñÁï•„ÄÅÊ®°ÂºèÂíåÁ§∫‰æã„ÄÇÊ∂µÁõñÂÖ≥ÈîÆ‰ªªÂä°ÂÆ°ÊâπÁ≥ªÁªüÁöÑÊµãËØïÊñπÊ≥ïËÆ∫„ÄÇ

### **ÊµãËØïËåÉÂõ¥**
- **Â∑•‰ΩúÊµÅÂºïÊìéÊµãËØï**: BPMNÂ∑•‰ΩúÊµÅÊâßË°åÂíåÁä∂ÊÄÅÁÆ°ÁêÜ
- **ÂÆ°ÊâπÁ≥ªÁªüÊµãËØï**: Â§öÁ∫ßÂÆ°ÊâπÈìæÂíåË∑ØÁî±ÈÄªËæë
- **ÂÜ≥Á≠ñÊîØÊåÅÊµãËØï**: AIÊé®ËçêÂíåÈ£éÈô©ËØÑ‰º∞È™åËØÅ
- **ÂÖ±ËØÜÊµãËØï**: Â§öÊñπÂçèËÆÆÂíåÊäïÁ•®Êú∫Âà∂
- **ÈõÜÊàêÊµãËØï**: Ë∑®Ê®°ÂùóÂ∑•‰ΩúÊµÅÈõÜÊàêÊµãËØï
- **ÂêàËßÑÊµãËØï**: ÁõëÁÆ°ÂêàËßÑÂíåÂÆ°ËÆ°Ë∑üË∏™È™åËØÅ

---

## üß™ Â∑•‰ΩúÊµÅÂºïÊìéÊµãËØïÁ≠ñÁï•

### **Â∑•‰ΩúÊµÅÊâßË°åÂçïÂÖÉÊµãËØï**

#### **Â∑•‰ΩúÊµÅÊúçÂä°ÊµãËØï**
```typescript
import { Test, TestingModule } from '@nestjs/testing';
import { EnterpriseWorkflowService } from '../services/enterprise-workflow.service';
import { WorkflowRepository } from '../repositories/workflow.repository';
import { ApprovalRouter } from '../routers/approval.router';
import { NotificationService } from '../services/notification.service';
import { AuditLogger } from '../loggers/audit.logger';

describe('EnterpriseWorkflowService', () => {
  let service: EnterpriseWorkflowService;
  let workflowRepository: jest.Mocked<WorkflowRepository>;
  let approvalRouter: jest.Mocked<ApprovalRouter>;
  let notificationService: jest.Mocked<NotificationService>;
  let auditLogger: jest.Mocked<AuditLogger>;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [
        EnterpriseWorkflowService,
        {
          provide: WorkflowRepository,
          useValue: {
            createApprovalRequest: jest.fn(),
            findApprovalRequest: jest.fn(),
            findMatchingWorkflows: jest.fn(),
            getWorkflowStep: jest.fn(),
            findStepDecision: jest.fn()
          }
        },
        {
          provide: ApprovalRouter,
          useValue: {
            routeApproval: jest.fn()
          }
        },
        {
          provide: NotificationService,
          useValue: {
            sendInitialNotifications: jest.fn(),
            sendDecisionNotifications: jest.fn()
          }
        },
        {
          provide: AuditLogger,
          useValue: {
            logApprovalRequestCreated: jest.fn(),
            logApprovalDecision: jest.fn()
          }
        }
      ]
    }).compile();

    service = module.get<EnterpriseWorkflowService>(EnterpriseWorkflowService);
    workflowRepository = module.get(WorkflowRepository);
    approvalRouter = module.get(ApprovalRouter);
    notificationService = module.get(NotificationService);
    auditLogger = module.get(AuditLogger);
  });

  describe('createApprovalRequest', () => {
    it('Â∫îËØ•‰ΩøÁî®ÊúâÊïàÂ∑•‰ΩúÊµÅÂàõÂª∫ÂÆ°ÊâπËØ∑Ê±Ç', async () => {
      // ÂáÜÂ§á
      const request: CreateApprovalRequest = {
        requestType: 'budget_approval',
        title: 'Q4Ëê•ÈîÄÈ¢ÑÁÆó',
        description: 'Q4Ëê•ÈîÄÊ¥ªÂä®È¢ÑÁÆóÂÆ°Êâπ',
        priority: Priority.High,
        urgency: Urgency.Normal,
        requestedBy: 'user-001',
        contextId: 'ctx-001',
        subject: {
          subjectType: 'budget_allocation',
          subjectId: 'budget-q4-marketing',
          amount: 500000,
          currency: 'USD',
          category: 'marketing_expenses'
        }
      };

      const expectedWorkflow = {
        workflowId: 'wf-budget-approval-001',
        workflowName: 'È¢ÑÁÆóÂÆ°ÊâπÂ∑•‰ΩúÊµÅ',
        steps: [
          {
            stepId: 'step-001',
            stepName: 'ÁªèÁêÜÂÆ°Êâπ',
            stepType: 'human_approval',
            required: true
          }
        ]
      };

      const expectedApprovalRoute = {
        routeId: 'route-001',
        currentApprovers: [
          {
            approverId: 'manager-001',
            approverName: 'Âº†ÁªèÁêÜ',
            stepName: 'ÁªèÁêÜÂÆ°Êâπ'
          }
        ]
      };

      const expectedApprovalRequest = {
        requestId: 'req-001',
        requestType: 'budget_approval',
        title: 'Q4Ëê•ÈîÄÈ¢ÑÁÆó',
        status: ApprovalStatus.Submitted,
        workflowId: 'wf-budget-approval-001',
        createdAt: new Date()
      };

      // ËÆæÁΩÆÊ®°Êãü
      workflowRepository.findMatchingWorkflows.mockResolvedValue([expectedWorkflow]);
      approvalRouter.routeApproval.mockResolvedValue(expectedApprovalRoute);
      workflowRepository.createApprovalRequest.mockResolvedValue(expectedApprovalRequest);

      // ÊâßË°å
      const result = await service.createApprovalRequest(request);

      // È™åËØÅ
      expect(result).toEqual(expectedApprovalRequest);
      expect(workflowRepository.findMatchingWorkflows).toHaveBeenCalledWith({
        requestType: 'budget_approval',
        amount: 500000,
        currency: 'USD'
      });
      expect(approvalRouter.routeApproval).toHaveBeenCalledWith(request, expectedWorkflow);
      expect(notificationService.sendInitialNotifications).toHaveBeenCalledWith(
        expectedApprovalRequest,
        expectedApprovalRoute
      );
      expect(auditLogger.logApprovalRequestCreated).toHaveBeenCalled();
    });

    it('Â∫îËØ•Âú®Ê≤°ÊúâÂåπÈÖçÂ∑•‰ΩúÊµÅÊó∂ÊäõÂá∫ÈîôËØØ', async () => {
      // ÂáÜÂ§á
      const request: CreateApprovalRequest = {
        requestType: 'invalid_type',
        title: 'Êó†ÊïàËØ∑Ê±Ç',
        requestedBy: 'user-001'
      };

      // ËÆæÁΩÆÊ®°Êãü
      workflowRepository.findMatchingWorkflows.mockResolvedValue([]);

      // ÊâßË°åÂíåÈ™åËØÅ
      await expect(service.createApprovalRequest(request))
        .rejects
        .toThrow('Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÂ∑•‰ΩúÊµÅ');
    });
  });

  describe('processApprovalDecision', () => {
    it('Â∫îËØ•ÊàêÂäüÂ§ÑÁêÜÂÆ°ÊâπÂÜ≥Á≠ñ', async () => {
      // ÂáÜÂ§á
      const requestId = 'req-001';
      const decision: ApprovalDecision = {
        decision: 'approved',
        decisionRationale: 'È¢ÑÁÆóÂàÜÈÖçÂêàÁêÜÔºåÁ¨¶ÂêàÂÖ¨Âè∏ÊàòÁï•',
        approverId: 'manager-001',
        stepName: 'ÁªèÁêÜÂÆ°Êâπ',
        processedAt: new Date()
      };

      const existingRequest = {
        requestId: 'req-001',
        status: ApprovalStatus.InProgress,
        currentStep: 'ÁªèÁêÜÂÆ°Êâπ',
        workflowId: 'wf-budget-approval-001'
      };

      const expectedResult = {
        decisionId: 'decision-001',
        requestId: 'req-001',
        decisionStatus: 'processed',
        workflowStatus: 'approved',
        nextActions: []
      };

      // ËÆæÁΩÆÊ®°Êãü
      workflowRepository.findApprovalRequest.mockResolvedValue(existingRequest);
      workflowRepository.recordDecision.mockResolvedValue({
        decisionId: 'decision-001',
        decision: 'approved'
      });

      // ÊâßË°å
      const result = await service.processApprovalDecision(requestId, decision);

      // È™åËØÅ
      expect(result.decisionStatus).toBe('processed');
      expect(workflowRepository.findApprovalRequest).toHaveBeenCalledWith(requestId);
      expect(auditLogger.logApprovalDecision).toHaveBeenCalled();
    });

    it('Â∫îËØ•Âú®ËØ∑Ê±Ç‰∏çÂ≠òÂú®Êó∂ÊäõÂá∫ÈîôËØØ', async () => {
      // ÂáÜÂ§á
      const requestId = 'non-existent';
      const decision: ApprovalDecision = {
        decision: 'approved',
        approverId: 'manager-001'
      };

      // ËÆæÁΩÆÊ®°Êãü
      workflowRepository.findApprovalRequest.mockResolvedValue(null);

      // ÊâßË°åÂíåÈ™åËØÅ
      await expect(service.processApprovalDecision(requestId, decision))
        .rejects
        .toThrow('ÂÆ°ÊâπËØ∑Ê±ÇÊú™ÊâæÂà∞');
    });
  });
});
```

### **ÂÆ°ÊâπË∑ØÁî±Âô®ÊµãËØï**

#### **Êô∫ËÉΩË∑ØÁî±ÊµãËØï**
```typescript
describe('IntelligentApprovalRouter', () => {
  let router: IntelligentApprovalRouter;
  let userService: jest.Mocked<UserService>;
  let aiRecommendationService: jest.Mocked<AIRecommendationService>;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [
        IntelligentApprovalRouter,
        {
          provide: UserService,
          useValue: {
            findUsersByRole: jest.fn(),
            findUsersByDepartment: jest.fn(),
            getUserWorkload: jest.fn()
          }
        },
        {
          provide: AIRecommendationService,
          useValue: {
            recommendApprovers: jest.fn()
          }
        }
      ]
    }).compile();

    router = module.get<IntelligentApprovalRouter>(IntelligentApprovalRouter);
    userService = module.get(UserService);
    aiRecommendationService = module.get(AIRecommendationService);
  });

  it('Â∫îËØ•Âü∫‰∫éËßíËâ≤ÈÄâÊã©ÂÆ°ÊâπËÄÖ', async () => {
    // ÂáÜÂ§á
    const request = {
      requestType: 'budget_approval',
      amount: 100000,
      department: 'marketing'
    };

    const workflow = {
      steps: [
        {
          stepId: 'step-001',
          approverSelection: {
            method: 'role_based',
            role: 'department_manager'
          }
        }
      ]
    };

    const expectedApprovers = [
      {
        userId: 'manager-001',
        userName: 'Âº†ÁªèÁêÜ',
        userRole: 'department_manager',
        department: 'marketing'
      }
    ];

    // ËÆæÁΩÆÊ®°Êãü
    userService.findUsersByRole.mockResolvedValue(expectedApprovers);

    // ÊâßË°å
    const result = await router.routeApproval(request, workflow);

    // È™åËØÅ
    expect(result.steps).toHaveLength(1);
    expect(result.steps[0].approvers).toEqual(expectedApprovers);
    expect(userService.findUsersByRole).toHaveBeenCalledWith('department_manager', {
      department: 'marketing'
    });
  });

  it('Â∫îËØ•‰ΩøÁî®AIÊé®ËçêÈÄâÊã©ÊúÄ‰Ω≥ÂÆ°ÊâπËÄÖ', async () => {
    // ÂáÜÂ§á
    const request = {
      requestType: 'budget_approval',
      amount: 500000,
      complexity: 'high'
    };

    const workflow = {
      steps: [
        {
          stepId: 'step-001',
          approverSelection: {
            method: 'ai_recommended'
          }
        }
      ]
    };

    const aiRecommendations = [
      {
        userId: 'expert-001',
        userName: 'Êùé‰∏ìÂÆ∂',
        confidence: 0.95,
        rationale: 'ÂÖ∑ÊúâÈ´òÈ¢ùÈ¢ÑÁÆóÂÆ°ÊâπÁªèÈ™å'
      }
    ];

    // ËÆæÁΩÆÊ®°Êãü
    aiRecommendationService.recommendApprovers.mockResolvedValue(aiRecommendations);

    // ÊâßË°å
    const result = await router.routeApproval(request, workflow);

    // È™åËØÅ
    expect(result.steps[0].approvers).toEqual(aiRecommendations);
    expect(aiRecommendationService.recommendApprovers).toHaveBeenCalledWith({
      requestType: 'budget_approval',
      amount: 500000,
      complexity: 'high'
    });
  });
});
```

---

## üîß ÈõÜÊàêÊµãËØïÁ≠ñÁï•

### **Á´ØÂà∞Á´ØÂ∑•‰ΩúÊµÅÊµãËØï**

```typescript
describe('ÂÆåÊï¥È¢ÑÁÆóÂÆ°ÊâπÂ∑•‰ΩúÊµÅ (E2E)', () => {
  let app: INestApplication;
  let workflowService: EnterpriseWorkflowService;
  let testDatabase: TestDatabase;

  beforeAll(async () => {
    // ËÆæÁΩÆÊµãËØïÂ∫îÁî®
    const moduleFixture: TestingModule = await Test.createTestingModule({
      imports: [ConfirmModule.forTest()]
    }).compile();

    app = moduleFixture.createNestApplication();
    await app.init();

    workflowService = app.get<EnterpriseWorkflowService>(EnterpriseWorkflowService);
    testDatabase = app.get<TestDatabase>(TestDatabase);
  });

  afterAll(async () => {
    await testDatabase.cleanup();
    await app.close();
  });

  it('Â∫îËØ•ÂÆåÊàêÂÆåÊï¥ÁöÑÈ¢ÑÁÆóÂÆ°ÊâπÊµÅÁ®ã', async () => {
    // Èò∂ÊÆµ1: ÂàõÂª∫ÂÆ°ÊâπËØ∑Ê±Ç
    const approvalRequest = await workflowService.createApprovalRequest({
      requestType: 'budget_approval',
      title: 'ÊµãËØïÈ¢ÑÁÆóÂÆ°Êâπ',
      amount: 100000,
      requestedBy: 'test-user-001'
    });

    expect(approvalRequest.status).toBe(ApprovalStatus.Submitted);

    // Èò∂ÊÆµ2: Á¨¨‰∏ÄÁ∫ßÂÆ°Êâπ (ÈÉ®Èó®ÁªèÁêÜ)
    const managerDecision = await workflowService.processApprovalDecision(
      approvalRequest.requestId,
      {
        decision: 'approved',
        approverId: 'manager-001',
        decisionRationale: 'È¢ÑÁÆóÂêàÁêÜ'
      }
    );

    expect(managerDecision.workflowStatus).toBe('in_progress');

    // Èò∂ÊÆµ3: Á¨¨‰∫åÁ∫ßÂÆ°Êâπ (Ë¥¢Âä°)
    const financeDecision = await workflowService.processApprovalDecision(
      approvalRequest.requestId,
      {
        decision: 'approved',
        approverId: 'finance-001',
        decisionRationale: 'Ë¥¢Âä°ÂÆ°Êü•ÈÄöËøá'
      }
    );

    expect(financeDecision.workflowStatus).toBe('approved');

    // Èò∂ÊÆµ4: È™åËØÅÊúÄÁªàÁä∂ÊÄÅ
    const finalStatus = await workflowService.getApprovalStatus(approvalRequest.requestId);
    expect(finalStatus.status).toBe(ApprovalStatus.Approved);
    expect(finalStatus.completedSteps).toHaveLength(2);
  });
});
```

---

## üîó Áõ∏ÂÖ≥ÊñáÊ°£

- [ConfirmÊ®°ÂùóÊ¶ÇËßà](./README.md) - Ê®°ÂùóÊ¶ÇËßàÂíåÊû∂ÊûÑ
- [APIÂèÇËÄÉ](./api-reference.md) - APIÂèÇËÄÉÊñáÊ°£
- [ÈÖçÁΩÆÊåáÂçó](./configuration-guide.md) - ÈÖçÁΩÆÈÄâÈ°π
- [ÂÆûÊñΩÊåáÂçó](./implementation-guide.md) - ÂÆûÊñΩÊåáÂçó
- [ÊÄßËÉΩÊåáÂçó](./performance-guide.md) - ÊÄßËÉΩ‰ºòÂåñ
- [ÈõÜÊàêÁ§∫‰æã](./integration-examples.md) - ÈõÜÊàêÁ§∫‰æã

---

**ÊµãËØïÁâàÊú¨**: 1.0.0-alpha  
**ÊúÄÂêéÊõ¥Êñ∞**: 2025Âπ¥9Êúà3Êó•  
**‰∏ãÊ¨°ÂÆ°Êü•**: 2025Âπ¥12Êúà3Êó•  
**Áä∂ÊÄÅ**: ‰ºÅ‰∏öÈ™åËØÅ  

**‚ö†Ô∏è AlphaÁâàÊú¨ËØ¥Êòé**: ConfirmÊ®°ÂùóÊµãËØïÊåáÂçóÂú®AlphaÁâàÊú¨‰∏≠Êèê‰æõ‰ºÅ‰∏öÁ∫ßÂÆ°ÊâπÂ∑•‰ΩúÊµÅÊµãËØïÁ≠ñÁï•„ÄÇÈ¢ùÂ§ñÁöÑÈ´òÁ∫ßÊµãËØïÊ®°ÂºèÂíåÈ™åËØÅÊñπÊ≥ïÂ∞ÜÂú®BetaÁâàÊú¨‰∏≠Ê∑ªÂä†„ÄÇ
