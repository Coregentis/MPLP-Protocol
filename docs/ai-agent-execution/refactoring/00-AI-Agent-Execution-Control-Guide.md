# AI Agent执行控制指南

## 🚨 **AI Agent必读 - 执行前强制要求**

**⚠️ 重要提醒**: 在执行任何MPLP模块重构任务前，AI Agent必须完整阅读本文档，理解所有约束和规则，然后严格按照指定流程执行。

## 🎯 **执行控制原则**

### **1. 强制执行顺序**
```markdown
✅ 必须按照以下顺序执行：

第一步：阅读本控制指南 (00-AI-Agent-Execution-Control-Guide.md)
第二步：阅读项目概述 (01-MPLP-Refactoring-Overview.md)
第三步：阅读统一架构标准 (02-MPLP-Unified-Architecture-Standard.md)
第四步：阅读统一质量标准 (03-MPLP-Unified-Quality-Standard.md)
第五步：根据具体任务阅读对应模块的重构指南
第六步：严格按照模块指南的实施步骤执行

❌ 禁止行为：
- 跳过任何前置文档的阅读
- 不按照指定顺序执行
- 忽视约束条件和质量标准
- 偏离既定的重构策略
```

### **2. 项目约束理解**
```markdown
🔒 必须理解的核心约束：

架构约束：
- MPLP v1.0是L1-L3协议栈，不是AI Agent本身
- 严格遵循4层DDD架构：API/Application/Domain/Infrastructure
- 每个模块必须实现IMLPPProtocol接口
- 必须集成9个横切关注点管理器

技术约束：
- 零any、unknown、console类型使用（ZERO TOLERANCE）
- TypeScript严格模式，0编译错误
- ESLint 0错误和警告
- 双重命名约定：Schema(snake_case) ↔ TypeScript(camelCase)
- 必须根据实际业务需求定义具体类型

质量约束：
- 测试覆盖率≥95%
- 测试通过率100%
- 所有质量门禁必须通过
- 完整的8文件文档套件

协议边界约束：
- L1-L3协议层不包含AI决策算法
- AI逻辑属于L4应用层
- 协议提供标准接口，不实现具体AI功能
```

## 🚨 **Context和Plan模块重构经验总结**

### **关键问题识别**
基于Context和Plan模块重构的实际经验，识别出以下关键问题：

#### **1. TypeScript和ESLint技术债务问题**
```markdown
❌ 发现的问题：
- any类型使用导致类型安全缺失
- unknown类型使用不当，需要根据实际定义重构
- console类型使用违反生产代码规范
- 大量TypeScript编译错误和ESLint警告

✅ 解决方案：
- 绝对禁止any、unknown、console类型
- 必须根据实际业务需求定义具体类型
- 每完成一个开发阶段立即清零技术债务
- 建立技术债务检查的强制门禁
```

#### **2. Schema驱动开发执行不到位**
```markdown
❌ 发现的问题：
- 未严格按照Schema定义进行开发
- 字段映射不完整或不准确
- 双重命名约定执行不一致

✅ 解决方案：
- 严格按照Schema → 字段映射 → 双重命名 → 开发的顺序执行
- 每个阶段完成后必须进行技术债务清零检查
- 建立Schema合规性的自动化验证
```

#### **3. 测试驱动开发与源代码完善闭环缺失**
```markdown
❌ 发现的问题：
- 测试文件与实际源代码不匹配
- 测试过程中发现的源代码问题未及时修复
- 缺乏测试驱动的源代码完善机制

✅ 解决方案：
- 根据实际源代码构建测试文件
- 以测试为驱动完善和修复源代码
- 建立测试-源代码双向完善的闭环机制
```

### **强化执行要求**
```markdown
🔒 基于实际经验的强化要求：

阶段性技术债务清零：
- Schema定义完成后 → 立即进行TypeScript和ESLint检查
- 字段映射完成后 → 立即进行类型定义检查
- 双重命名完成后 → 立即进行命名约定检查
- 每个功能模块完成后 → 立即进行完整技术债务检查

测试驱动源代码完善：
- 根据实际源代码结构构建测试文件
- 测试过程中发现源代码问题立即修复
- 测试失败时优先修复源代码而不是修改测试
- 建立测试通过率100%的强制要求
```

## 📋 **执行前检查清单**

### **知识准备检查**
```markdown
在开始任何重构任务前，AI Agent必须确认：

□ 已完整阅读项目概述，理解MPLP v1.0的定位和目标
□ 已掌握统一架构标准，理解4层DDD架构要求
□ 已掌握统一质量标准，理解测试和代码质量要求
□ 已理解双重命名约定和Schema驱动开发原则
□ 已理解协议边界，明确L1-L3与L4的职责分工
□ 已阅读对应模块的具体重构指南
□ 已理解该模块的重构目标和策略
□ 已掌握该模块的实施步骤和验收标准
```

### **环境准备检查**
```markdown
在开始编码前，AI Agent必须确认：

□ 已使用codebase-retrieval了解现有代码结构
□ 已分析现有模块的架构和实现
□ 已识别需要重构的具体问题
□ 已制定详细的重构计划
□ 已准备测试策略和验证方法
```

## 🔄 **标准执行流程**

### **Phase 1: 信息收集和分析**
```markdown
🔍 必须执行的分析步骤：

1. 使用codebase-retrieval深入分析现有模块：
   - 当前架构结构和设计模式
   - 现有服务和接口实现
   - 测试覆盖情况和质量状态
   - 依赖关系和集成点

2. 识别重构范围和影响：
   - 需要简化或重构的具体组件
   - 与其他模块的依赖关系
   - 数据迁移和兼容性要求
   - 测试更新和验证需求

3. 制定详细重构计划：
   - 具体的重构步骤和时间安排
   - 风险识别和缓解措施
   - 质量保证和验证策略
   - 回滚计划和应急预案
```

### **Phase 2: 架构设计和验证**
```markdown
🏗️ 必须执行的设计步骤：

1. 设计新架构：
   - 严格按照统一架构标准设计
   - 确保4层DDD架构的正确实现
   - 设计3个标准企业级服务
   - 集成9个横切关注点管理器

2. 接口设计：
   - 实现标准化的IMLPPProtocol接口
   - 设计统一的请求路由逻辑
   - 实现标准的错误处理机制
   - 确保响应格式的一致性

3. 数据模型设计：
   - 遵循双重命名约定
   - 实现Schema-TypeScript映射
   - 确保数据一致性和完整性
   - 设计数据迁移策略
```

### **Phase 3: 实现和测试**
```markdown
💻 必须执行的实现步骤：

1. 代码实现：
   - 严格按照设计文档实现
   - 遵循所有技术约束和质量标准
   - 实现完整的错误处理和日志记录
   - 确保代码的可读性和可维护性

2. 测试实现：
   - 编写完整的单元测试（覆盖率≥95%）
   - 创建集成测试套件
   - 实现性能基准测试
   - 进行安全和合规测试

3. 质量验证：
   - 执行所有质量门禁检查
   - 确保TypeScript编译0错误
   - 确保ESLint检查0错误和警告
   - 验证测试通过率100%
```

### **Phase 4: 验收和交付**
```markdown
✅ 必须执行的验收步骤：

1. 功能验收：
   - 验证所有功能按设计正确实现
   - 确保向后兼容性
   - 验证性能指标达标
   - 确保安全和合规要求满足

2. 质量验收：
   - 所有测试100%通过
   - 代码质量标准100%达标
   - 文档完整性100%
   - 架构合规性100%

3. 交付准备：
   - 更新相关文档
   - 创建迁移指南
   - 准备部署脚本
   - 生成验收报告
```

## 🚫 **严格禁止的行为**

### **架构违规行为**
```markdown
❌ 绝对禁止：
- 偏离4层DDD架构标准
- 不实现IMLPPProtocol接口
- 忽略横切关注点集成
- 违反协议边界原则
- 在L1-L3层实现AI决策算法
```

### **代码质量违规**
```markdown
❌ 绝对禁止：
- 使用any、unknown、console类型（ZERO TOLERANCE）
- 忽略TypeScript编译错误
- 忽略ESLint错误和警告
- 违反双重命名约定
- 跳过测试或降低测试标准
- 不根据实际业务需求定义具体类型
- 跳过阶段性技术债务清零检查
```

### **流程违规行为**
```markdown
❌ 绝对禁止：
- 跳过信息收集和分析阶段
- 不按照模块重构指南执行
- 忽略风险评估和缓解措施
- 不进行充分的测试和验证
- 不更新相关文档
```

## 🔧 **问题处理机制**

### **遇到技术问题时**
```markdown
🛠️ 标准处理流程：

1. 问题识别和分析：
   - 详细描述遇到的问题
   - 分析问题的根本原因
   - 评估问题的影响范围
   - 查找相关文档和最佳实践

2. 解决方案制定：
   - 制定多个可选解决方案
   - 评估每个方案的优缺点
   - 选择最符合项目约束的方案
   - 制定实施计划和验证方法

3. 实施和验证：
   - 按照计划实施解决方案
   - 进行充分的测试和验证
   - 确保不引入新的问题
   - 更新相关文档和记录
```

### **遇到约束冲突时**
```markdown
⚖️ 冲突解决原则：

优先级顺序：
1. 项目核心约束（架构、质量、协议边界）
2. 技术标准和最佳实践
3. 性能和用户体验
4. 开发效率和便利性

处理流程：
1. 明确识别冲突的约束条件
2. 分析冲突的根本原因
3. 寻找满足所有约束的解决方案
4. 如无法完全满足，按优先级选择
5. 记录决策过程和理由
```

## 📊 **执行监控和报告**

### **进度监控要求**
```markdown
📈 必须提供的进度信息：

每个阶段完成后报告：
- 完成的具体任务和成果
- 遇到的问题和解决方案
- 质量指标和测试结果
- 下一阶段的计划和风险

最终交付报告：
- 重构目标达成情况
- 性能改进效果
- 质量标准符合情况
- 遗留问题和后续计划
```

### **质量报告要求**
```markdown
📋 必须提供的质量报告：

代码质量报告：
- TypeScript编译结果
- ESLint检查结果
- 测试覆盖率和通过率
- 架构合规性检查结果

性能报告：
- 性能基准测试结果
- 与重构前的性能对比
- 资源使用情况分析
- 性能优化建议

文档报告：
- 文档完整性检查
- 文档准确性验证
- 示例代码可用性测试
- 用户反馈和改进建议
```

## 🎯 **成功标准确认**

### **最终验收标准**
```markdown
✅ 重构成功的标志：

架构标准：
□ 100%符合4层DDD架构标准
□ 100%实现IMLPPProtocol接口
□ 100%集成9个横切关注点
□ 100%通过架构合规性检查

质量标准：
□ 测试覆盖率≥95%
□ 测试通过率100%
□ TypeScript编译0错误
□ ESLint检查0错误和警告

性能标准：
□ 达到或超过预期性能指标
□ 资源使用优化达标
□ 响应时间改进达标
□ 并发处理能力提升达标

文档标准：
□ 完整的8文件文档套件
□ API文档准确完整
□ 使用指南清晰易懂
□ 示例代码可用有效
```

---

**文档版本**: v1.0  
**创建时间**: 2025-01-27  
**适用范围**: 所有MPLP模块重构任务  
**强制执行**: 所有AI Agent必须严格遵循  
**更新频率**: 根据项目进展和经验积累持续更新
