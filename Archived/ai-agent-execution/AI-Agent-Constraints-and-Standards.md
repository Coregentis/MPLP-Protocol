# AI Agent Constraints and Standards v3.0 - 基于6个已完成模块的企业级统一架构标准

## 🚨 **强制约束 (ZERO TOLERANCE)**

### **架构约束**
```markdown
❌ 绝对禁止违反的架构约束：

1. 统一架构模式违反
   - 禁止偏离6个已完成模块的企业级成功架构模式
   - 禁止在模块内重复实现横切关注点
   - 禁止不使用统一的L3管理器注入模式
   - 禁止创建模块特定的横切关注点实现

2. AI功能架构边界违反
   - 禁止在L1-L3协议层实现AI决策算法
   - 禁止在协议层包含机器学习模型
   - 禁止绑定特定AI技术栈

3. 协议模块定位违反
   - 禁止将协议模块等同于单一Agent
   - 禁止在协议层实现行业特定智能功能
   - 禁止违反"协议是积木，Agent是建筑"的原则
```

### **代码质量约束**
```markdown
❌ 零容忍的代码质量约束：

1. TypeScript类型安全
   - 绝对禁止使用any类型
   - TypeScript编译必须0错误
   - 所有接口必须严格类型定义

2. ESLint代码质量
   - ESLint检查必须0警告
   - 代码格式必须统一标准
   - 未使用变量必须清理（除下划线前缀参数）

3. 双重命名约定
   - Schema层必须使用snake_case
   - TypeScript层必须使用camelCase
   - 映射一致性必须100%
   - 禁止混用命名约定
```

### **实施流程约束**
```markdown
❌ 强制执行的流程约束：

1. 文档阅读顺序
   - 必须按照Master Guide规定的顺序阅读文档
   - 禁止跳过任何强制阅读文档
   - 必须完成架构理解验证才能继续

2. 阶段执行顺序
   - 必须按照7个阶段的顺序执行
   - 禁止跳过任何阶段
   - 每个阶段必须完成验证才能进入下一阶段

3. 质量门禁执行
   - 所有质量门禁必须100%通过
   - 禁止绕过质量检查
   - 失败时必须修复后重新验证
```

## ✅ **强制标准 (MANDATORY COMPLIANCE)**

### **Schema驱动开发标准**
```markdown
✅ 必须遵循的Schema标准：

1. Schema定义标准
   - 基于JSON Schema Draft-07标准
   - 包含完整的$schema、$id、title、description
   - 使用snake_case命名约定
   - 包含详细的字段约束和验证规则

2. Mapper实现标准
   - 实现完整的双向映射方法
   - 包含所有9个横切关注点映射
   - 实现批量转换和验证方法
   - 确保100%字段映射覆盖

3. 数据验证标准
   - 实现严格的Schema验证
   - 包含类型检查和格式验证
   - 提供详细的错误信息
   - 支持批量数据验证
```

### **统一横切关注点集成标准（与Context和Plan模块IDENTICAL）**
```markdown
CRITICAL: 必须与Context和Plan模块使用完全相同的集成标准

✅ 必须遵循的统一集成标准：

1. 统一L3管理器注入标准（与Context和Plan模块完全相同）
   - 构造函数必须注入所有9个L3管理器（与Context和Plan模块相同的注入方式）
   - 继承MLPPProtocolBase基类（与Context和Plan模块相同的基类）
   - 实现IMLPPProtocol接口（与Context和Plan模块相同的接口）
   - 配置正确的依赖注入（与Context和Plan模块相同的配置方式）

2. 统一业务逻辑集成标准（与Context和Plan模块完全相同）
   - 每个操作必须包含安全验证（与Context和Plan模块相同的验证逻辑）
   - 每个操作必须包含性能监控（与Context和Plan模块相同的监控方式）
   - 状态变更必须发布事件（与Context和Plan模块相同的事件发布）
   - 数据操作必须包含事务管理（与Context和Plan模块相同的事务处理）
   - 错误处理必须使用横切关注点错误管理器（与Context和Plan模块相同的错误处理）

3. 统一横切关注点调用顺序标准（与Context和Plan模块完全相同）
   - 1. 安全验证（与Context和Plan模块相同的验证步骤）
   - 2. 性能监控开始（与Context和Plan模块相同的监控开始）
   - 3. 事务管理开始（与Context和Plan模块相同的事务开始）
   - 4. 业务逻辑执行（与Context和Plan模块相同的执行模式）
   - 5. 状态同步（与Context和Plan模块相同的同步方式）
   - 6. 事件发布（与其他模块相同的发布方式）
   - 7. 事务提交（与Context和Plan模块相同的提交方式）
   - 8. 性能监控结束（与Context和Plan模块相同的监控结束）
   - 9. 错误处理（catch块，与Context和Plan模块相同的错误处理）
```

### **统一预留接口实现标准（与Context和Plan模块IDENTICAL）**
```markdown
CRITICAL: 必须与Context和Plan模块使用完全相同的接口标准

✅ 必须遵循的统一接口标准：

1. 统一Interface-First模式标准（与Context和Plan模块完全相同）
   - 定义完整的接口签名（与Context和Plan模块相同的签名模式）
   - 使用下划线前缀参数（与Context和Plan模块相同的命名约定）
   - 添加TODO注释等待激活（与Context和Plan模块相同的注释格式）
   - 提供临时实现返回成功（与Context和Plan模块相同的临时实现模式）

2. 统一预留接口数量标准（与Context和Plan模块保持一致）
   - 企业级重写模块：8-10个预留接口（与Context和Plan模块相同）
   - 所有待重写模块：8-10个预留接口（统一企业级标准）
   - 基准参考：Context和Plan模块的成功实现模式

3. 统一接口分类标准（与Context和Plan模块完全相同）
   - 核心协调接口（4个深度集成模块，与Context和Plan模块相同的分类）
   - 扩展协调接口（4个额外模块，与Context和Plan模块相同的扩展模式）
   - 专业化协调接口（模块特定，与Context和Plan模块相同的特化模式）

4. 统一横切关注点集成标准（与Context和Plan模块完全相同）
   - 权限相关接口集成安全管理器（与Context和Plan模块相同的安全集成）
   - 性能相关接口集成性能监控器（与Context和Plan模块相同的监控集成）
   - 协调相关接口集成协调管理器（与Context和Plan模块相同的协调集成）
   - 数据相关接口集成事务管理器（与Context和Plan模块相同的事务集成）
```

### **统一质量保证标准（与Context和Plan模块相同标准）**
```markdown
CRITICAL: 必须达到与Context和Plan模块相同的企业级质量标准

✅ 必须达到的统一质量标准：

1. 企业级重写标准（与Context和Plan模块相同）
   - 测试通过率：100%（Context: 499/499, Plan: 170/170）
   - 测试覆盖率：>95%（Context: 95%+, Plan: 95.2%）
   - TypeScript错误：0（与Context和Plan模块相同的零技术债务）
   - ESLint警告：0（与Context和Plan模块相同的代码质量）
   - Schema映射一致性：100%（与Context和Plan模块相同的映射标准）
   - 横切关注点集成：100%（与Context和Plan模块相同的9个关注点集成）
   - 预留接口实现：100%（与Context和Plan模块相同的接口模式）
   - 性能SLA：<100ms响应时间，>99.9%可用性（与Context和Plan模块相同性能）
   - 安全合规：100%（与Context和Plan模块相同安全标准）
   - 文档覆盖：100%（与Context和Plan模块相同的8文件文档套件）
   - 架构一致性：100%与Context和Plan模块的架构一致

2. 完整文档套件标准（与Context和Plan模块相同）
   - README.md：主文档，概述和快速开始
   - architecture-guide.md：详细架构文档
   - api-reference.md：完整API文档
   - schema-reference.md：Schema规范文档
   - testing-guide.md：测试指南和最佳实践
   - field-mapping.md：字段映射参考
   - quality-report.md：质量指标报告
   - completion-report.md：完成状态报告

3. 统一4层验证系统标准（与Context和Plan模块相同验证体系）
   - Tier 1: Unit Testing（单元测试，与Context和Plan模块相同测试方式）
   - Tier 2: Integration Testing（集成测试，与Context和Plan模块相同集成方式）
   - Tier 3: Functional Testing（功能测试，与Context和Plan模块相同功能验证）
   - Tier 4: System Validation（系统验证，与Context和Plan模块相同系统验证）
   - 所有层次必须100%通过（与Context和Plan模块相同通过标准）
   - 架构一致性验证：确保与Context和Plan模块的架构完全一致
```

## 📋 **成功模式参考标准（基于Context和Plan模块的企业级架构经验）**

### **企业级重写模块参考**
```markdown
✅ Context模块成功模式（企业级标准）：
- 14个功能域，17个专业化服务
- 完整的上下文生命周期管理
- 多维度上下文数据管理
- 测试通过率：100% (499/499)
- 测试覆盖率：95%+
- 完整8文件文档套件
- 100%测试通过率
- 完整的横切关注点集成

✅ Plan模块成功模式（企业级标准）：
- AI驱动的智能任务规划算法
- 8个MPLP模块预留接口（lines 851-989）
- 多目标优化引擎
- 实时监控和性能分析
- 测试通过率：100% (170/170)
- 测试覆盖率：95.2%
- 完整8文件文档套件
```

### **待重写模块目标（需要达到Context和Plan模块的企业级标准）**
```markdown
🎯 Confirm模块重写目标：
- 企业级审批工作流
- 多级审批机制
- 委托和升级功能
- 完整的审批追踪
- 目标：95%+测试覆盖率，完整8文件文档套件

🎯 Trace模块重写目标：
- 分布式追踪和性能监控
- 执行监控和审计追踪
- 实时性能分析
- 问题诊断能力
- 目标：95%+测试覆盖率，完整8文件文档套件

🎯 Role模块重写目标：
- 企业级RBAC系统
- 角色管理和权限控制
- 安全审计和合规
- 完整的权限追踪
- 目标：95%+测试覆盖率，完整8文件文档套件

🎯 Extension模块重写目标：
- 扩展生命周期管理
- 插件协调和管理
- AI驱动推荐功能
- 分布式扩展支持
- 目标：95%+测试覆盖率，完整8文件文档套件
```

## 🔧 **统一实施验证检查清单（基于6个已完成模块的验证经验）**

### **每个阶段必须验证的统一检查点（与其他6个模块相同的验证标准）**
```markdown
□ 阶段1: 架构理解验证
  - 文档阅读完整性确认
  - 架构理解问题正确回答
  - 模块定位和特色功能理解
  - 横切关注点需求分析

□ 阶段2: Schema集成验证
  - 字段映射表生成完整
  - Mapper类实现完整
  - 双重命名约定遵循
  - 质量门禁通过

□ 阶段3: 横切关注点集成验证
  - 9个L3管理器注入完整
  - 业务逻辑集成模式正确
  - 调用顺序标准遵循
  - 集成测试通过

□ 阶段4: 预留接口验证
  - 接口数量符合标准
  - Interface-First模式遵循
  - 参数命名约定正确
  - 横切关注点集成完整

□ 阶段5: 协议接口验证
  - IMLPPProtocol接口实现完整
  - 协议元数据准确
  - 健康检查功能正常
  - 协议工厂配置正确

□ 阶段6: 质量验证
  - 4层验证系统全部通过
  - 质量门禁100%通过
  - 目标质量标准达成
  - 质量报告生成完整

□ 阶段7: 完成验证
  - 重构完成报告详细
  - 架构合规性确认
  - 文档更新完整
  - 实施经验记录
```

## 🚨 **统一违规处理机制（基于6个已完成模块的合规经验）**

### **违规检测和处理**
```markdown
⚠️ 发现违规时的处理流程：

1. 立即停止当前阶段执行
2. 详细分析违规原因和影响
3. 查阅相关约束和标准文档
4. 制定修复方案和验证计划
5. 修复违规问题
6. 重新执行质量验证
7. 确认合规后继续执行

⚠️ 常见违规类型（基于6个已完成模块的经验）：
- 跳过强制文档阅读（违反统一学习标准）
- 违反代码质量约束（偏离零技术债务政策）
- 不遵循双重命名约定（破坏Schema-TypeScript映射一致性）
- 跳过质量门禁验证（违反企业级重写标准）
- 不完整的横切关注点集成（未能与Context和Plan模块保持一致）
- 预留接口实现不标准（偏离Context和Plan模块的接口模式）
- 偏离统一架构模式（与Context和Plan模块的架构不一致）
- 不使用相同的L3管理器注入模式（破坏架构一致性）
- 测试覆盖率不达标（未达到95%+企业级标准）
- 文档套件不完整（未达到8文件完整文档套件标准）
```

---

**约束版本**: 2.0.0
**执行级别**: 强制执行，零容忍违规
**适用范围**: 所有MPLP v1.0模块重写任务
**统一架构要求**: 必须与Context和Plan模块保持完全一致
**质量基准**: 基于Context和Plan模块的企业级成功标准
**兼容性要求**: 100%与Context和Plan模块的架构和实现兼容
**重写标准**: 95%+测试覆盖率 + 零技术债务 + 完整8文件文档套件
**CRITICAL**: 确保所有8个待重写模块与Context和Plan模块使用IDENTICAL的企业级架构模式
